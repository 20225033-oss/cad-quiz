<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ã‚³ã‚¢å±¥æ­´</title>
  <style>
    body { font-family: "Segoe UI", sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>ã‚¹ã‚³ã‚¢å±¥æ­´</h1>

  <div id="userStats" style="margin-bottom: 15px; font-weight: bold;">
  çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
</div>


  <p>ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <span id="usernameDisplay"></span></p>
  <button onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  <button onclick="location.href='index.html'">ã‚¯ã‚¤ã‚ºã¸æˆ»ã‚‹</button>

  <table id="scoreTable">
    <thead>
      <tr>
        <th>æ—¥ä»˜</th>
        <th>ã‚¹ã‚³ã‚¢</th>
        <th>å…¨å•é¡Œæ•°</th>
        <th>æ­£ç­”ç‡</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª
    const username = sessionStorage.getItem("username");
    if (!username) {
      window.location.href = "login.html";
    }

    document.getElementById("usernameDisplay").textContent = username;

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    function logout() {
      sessionStorage.removeItem("username");
      window.location.href = "login.html";
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚³ã‚¢ã‚’å–å¾—
    fetch(`/get-scores/${username}`)
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#scoreTable tbody");

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4">ã‚¹ã‚³ã‚¢å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
          return;
        }

        data.forEach(score => {
          const percent = ((score.score / score.total) * 100).toFixed(1);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${new Date(score.date).toLocaleString()}</td>
            <td>${score.score}</td>
            <td>${score.total}</td>
            <td>${percent}%</td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(err => {
        console.error("âš ï¸ ã‚¹ã‚³ã‚¢å–å¾—ã‚¨ãƒ©ãƒ¼:", err);
      });
    // ğŸ“Š ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    fetch(`/get-user-stats/${username}`) 
      .then(res => {
        if (!res.ok) throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${res.status}`);
        return res.json();
      })
      .then(stats => {
        console.log("ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿:", stats); // â† ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›è¿½åŠ 
        const statsDiv = document.getElementById("userStats");
        statsDiv.innerHTML = `
          å¹³å‡æ­£ç­”ç‡ï¼š${stats.avgPercent}%ã€€
          æœ€é«˜æ­£ç­”ç‡ï¼š${stats.maxPercent}%ã€€
          å—é¨“å›æ•°ï¼š${stats.attempts}å›
        `;
      })
      .catch(err => {
        console.error("âš ï¸ çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:", err);
        document.getElementById("userStats").textContent = "çµ±è¨ˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      });


  </script>
</body>
</html>
